### スケジューリングとは

- kubeletがPodを稼働させるためにNodeに割り当てること
- スケジューラーは新規に作成されたPodで、Nodeに割り当てられていないものを監視
- スケジューラーは発見した各Podのために、稼働させるべき最適なNodeを見つけ出す責務を担う


### Podがすでに作成されていて、そのPodをNodeに割り当てたい場合どうすれば良いか？
- バインディングオブジェクトを作成してPodのバインディングAPIにPOST送信し、実際のスケジューラーが行うことを模倣す

以下のBindingを作成し、curl --request POST　する
```
apiVersion: v1
kind: Binding
metadeta:
  name: nginx
target:
  apiVersion: v1
  kind: Node
  name: node2
```

### taintとtolerationとは

Kubernetesには最初、特定のnodeに特定のpodをscheduleする方法としてnode selectorを使う方法があった。(node selectorの他にも特定のnodeに特定のpodをscheduleするための仕組みとしてNode Affinityがある)

しかし後からもっと柔軟にscheduleするためのメカニズムが導入された。
それが`Taints`と`Tolerations`。

`Node Selector`や`Node Affinity`が特定のnodeに特定のpodをscheduleするための仕組みに対し、
`Taints`と`Tolerations`は特定のnodeにpodをscheduleしないための仕組み

`Node Affinity`などの場合には、それらが未指定の場合はどこのNodeにでもscheduleされてしまうが、
`Taints`と`Tolerations`の場合は指定しない限りそのNodeにscheduleされることはない。
1つもしくは複数の`Taints`をnodeに設定することができ、podには1つもしくは複数の`tolerations`を設定することができる。

**例えば以下のようにnodeにTaintsを設定した場合、**<br/>
`kubectl taint nodes node1 app=batch:NoSchedule`
`Tolerations`にapp=batchをもったpodではないとこのnodeにpodをscheduleできなくなる。

**podにTolerationsを設定する例**<br/>
以下のように設定した場合、keyが`app`でvalueが`batch`でeffectが`NoSchedule`のTaintsを持ったnodeにこのpodはscheduleできるようになる。
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: batch
spec:
  replicas: 3
  template:
    metadata:
      name: batch-pod
    spec:
      containers:
      - image: busybox
      tolerations:
      - key: "app"
        operator: "Equal"
        value: "batch"
        effect: "NoSchedule"
```


すでに付与したtaintを外すには、下記のコマンドを使用「`-`をつける」
`kubectl taint nodes node1 app=batch:NoSchedule-`
